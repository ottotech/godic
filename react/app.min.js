"use strict";var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var e=React.createElement,DatabaseInfo=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={info:data.DatabaseInfo},a}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",null,React.createElement("p",{style:styles.p},React.createElement("strong",null,"Database name: "),this.state.info.name),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Database user: "),this.state.info.user),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Database host: "),this.state.info.host),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Database driver: "),this.state.info.driver),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Database schema: "),this.state.info.schema),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Database port: "),this.state.info.port))}}]),t}(),TablesData=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.updateTableDictionary=function(e){var t=e.target.getAttribute("data-table-idx"),n=e.target.getAttribute("data-table-name"),l=window.location.protocol+"//"+window.location.host+"/update",r=a.state.tables[t],o=r.columns,s=[];if(confirm("Are you sure you want to update the dictionary of table "+n+"?")){for(var c=0;c<o.length;c++){var i={};i.col_id=o[c].id,i.description=o[c].description,s.push(i)}fetch(l,{method:"POST",body:JSON.stringify({table_id:r.id,table_description:r.description,columns_data:s})}).then((function(e){200===e.status?alert("table "+n+" has been updated successfully."):e.text().then((function(e){alert("An error occurred: "+e)}))})).catch((function(e){console.log(e)}))}},a.onChangeTableDesc=function(e){var t=e.target.getAttribute("data-table-idx"),n=a.state.tables;n[t].description=e.target.value,a.setState({tables:n})},a.onChangeColumnDesc=function(e){var t=e.target.getAttribute("data-table-idx"),n=e.target.getAttribute("data-col-idx"),l=a.state.tables;l[t].columns[n].description=e.target.value,a.setState({tables:l})},a.state={tables:[]},a.onChangeColumnDesc=a.onChangeColumnDesc.bind(a),a.onChangeTableDesc=a.onChangeTableDesc.bind(a),a}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){for(var e=data.Tables,t=data.Columns,a=0;a<e.length;a++){for(var n=[],l=0;l<t.length;l++)t[l].table_name===e[a].name&&n.push(t[l]);for(var r=!1,o=[],s=0;s<n.length;s++)!0===n[s].is_primary_key?r=s:!0===n[s].is_foreign_key&&o.push(s);if("number"==typeof r){var c=n.splice(r,1)[0];n.splice(0,0,c)}for(var i=0;i<o.length;i++){var u=n.splice(o[i],1)[0];n.splice(1,0,u)}for(var p=0;p<n.length;p++)n[p].has_enum&&(n[p].db_type="ENUM("+n[p].enum_values.join()+")");e[a].columns=n}this.setState({tables:e})}},{key:"rendeTables",value:function(){var e=this;return this.state.tables.map((function(t,a){return React.createElement(Table,{key:a,tableIdx:a,tableName:t.name,tableID:t.id,tableDescription:t.description,tableColumns:t.columns,onChangeColumnDesc:e.onChangeColumnDesc,onChangeTableDesc:e.onChangeTableDesc,onClickSave:e.updateTableDictionary})}))}},{key:"render",value:function(){return React.createElement("div",null,this.rendeTables(),React.createElement(TopBtn,null))}}]),t}(),Table=function(e){function t(){var e,a,n;_classCallCheck(this,t);for(var l=arguments.length,r=Array(l),o=0;o<l;o++)r[o]=arguments[o];return a=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),n.renderColumns=function(){return n.props.tableColumns.map((function(e,t){var a="";e.is_primary_key?a="PK":e.is_foreign_key&&(a="FK");var l=e.db_type;"VARCHAR"===e.db_type.toUpperCase()&&(l=l+"("+e.length+")");var r=!0===e.nullable?"YES":"NO",o=!0===e.is_unique?"YES":"NO";return React.createElement("tr",{key:t},React.createElement("td",{style:styles.table},a),React.createElement("td",{style:styles.table},e.name),React.createElement("td",{style:styles.table},l),React.createElement("td",{style:styles.table},r),React.createElement("td",{style:styles.table},o),React.createElement("td",{"data-table":e.table_name,"data-column-id":e.id,style:styles.table},React.createElement("textarea",{"data-table-idx":n.props.tableIdx,"data-table":e.table_name,"data-col-id":e.id,"data-col-idx":t,onChange:n.props.onChangeColumnDesc,rows:"5",cols:"50",value:e.description})))}))},_possibleConstructorReturn(n,a)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{style:{marginTop:50}},React.createElement("p",{style:styles.p},React.createElement("strong",null,"Table: "),this.props.tableName),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Description:")),React.createElement("div",{style:{display:"flex"}},React.createElement("textarea",{"data-table-idx":this.props.tableIdx,onChange:this.props.onChangeTableDesc,rows:"4",cols:"80",value:this.props.tableDescription}),React.createElement("button",{style:{width:60},type:"button","data-table-name":this.props.tableName,"data-table-idx":this.props.tableIdx,onClick:this.props.onClickSave},"save")),React.createElement("table",{style:styles.table},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:styles.table},"Key"),React.createElement("th",{style:styles.table},"Attribute"),React.createElement("th",{style:styles.table},"Data Type"),React.createElement("th",{style:styles.table},"Nullable"),React.createElement("th",{style:styles.table},"Unique"),React.createElement("th",{style:styles.table},"Description"))),React.createElement("tbody",null,this.renderColumns())))}}]),t}(),TopBtn=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={btn_display_style:"none",btn_opacity:.4},a.handleScroll=a.handleScroll.bind(a),a}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){window.addEventListener("scroll",this.handleScroll)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll)}},{key:"handleScroll",value:function(){var e=document.body.scrollTop,t=document.documentElement.scrollTop;e>20||t>20?this.setState({btn_display_style:"block"}):this.setState({btn_display_style:"None"})}},{key:"render",value:function(){var e=this,t={};return t.top_btn={display:this.state.btn_display_style,position:"fixed",bottom:20,right:30,zIndex:99,fontSize:18,border:"none",outline:"none",color:"grey",cursor:"pointer",padding:15,borderRadius:4,opacity:this.state.btn_opacity},React.createElement("div",null,React.createElement("button",{style:t.top_btn,id:"myBtn",onClick:function(){document.documentElement.scrollTop=0},onMouseOver:function(){return e.setState({btn_opacity:.8})},onMouseOut:function(){return e.setState({btn_opacity:.4})}},"Go to top"))}}]),t}(),styles={p:{margin:0},table:{border:"1px solid black"},saveBtn:{color:"white",padding:"15px 32px",textAlign:"center",fontSize:16,cursor:"pointer",backgroundColor:"#008CBA",marginLeft:3,outline:"none"}},domContainer=document.querySelector("#databaseInfo"),domContainerTwo=document.querySelector("#tablesData");ReactDOM.render(e(DatabaseInfo),domContainer),ReactDOM.render(e(TablesData),domContainerTwo);