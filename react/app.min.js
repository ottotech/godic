"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var e=React.createElement,DatabaseInfo=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.syncDatabase=function(){var e=window.location.protocol+"//"+window.location.host+"/sync-db";n.setState({syncIndicator:!0}),fetch(e,{method:"POST"}).then((function(e){if(n.setState({syncIndicator:!1}),200===e.status)return alert("The database has been synced successfully."),void(window.location.href="/");e.text().then((function(e){alert("An error occurred, your database might not be synced completely. Please run again the sync function: \n"+e)}))})).catch((function(e){console.log(e),this.setState({syncIndicator:!1}),alert("An error occurred, your database might not be synced completely. Please run again the sync function: \n"+e)}))},n.checkDatabaseChanges=function(){var e=window.location.protocol,t=window.location.host;fetch(e+"//"+t+"/check-changes",{method:"GET"}).then((function(e){200===e.status?e.json().then((function(e){console.log(e);var t=e.new_tables,a=e.deleted_tables,o=e.column_changes,l=e.deleted_columns,s=e.new_columns;if(0!==t.length||0!==a.length||0!==o.length||0!==l.length||0!==s.length){var r="Before syncing the database scroll down and check all changes detected by godic, if you want to proceed with the synchronization press OK. When existing columns are updated godic will remove the previous descriptions saved, so godic will force you to update the columns's descriptions.\n\n";if(t.length>0){r+="\nThere are new tables created:\n";for(var c=0;c<t.length;c++)r+="- "+t[c]+"\n"}if(a.length>0){r+="\nSome tables have been deleted:\n";for(var i=0;i<a.length;i++)r+="- "+a[i]+"\n"}if(o.length>0){r+="\nThere has been some changes in existing columns:\n";for(var u=0;u<o.length;u++)r+="- column ("+o[u].metadata.name+") in table ("+o[u].metadata.table_name+") suffered the following changes:\n"+o[u].changes_message+"\n"}if(l.length>0){r+="\nSome columns have been deleted:\n";for(var d=0;d<l.length;d++)r+="- column ("+l[d].name+") in table ("+l[d].table+")\n"}if(s.length>0){r+="\nThere are some new columns in existing tables:\n";for(var h=0;h<s.length;h++)r+="- new column ("+s[h].name+") in table ("+s[h].table+")\n"}confirm(r)&&n.syncDatabase()}else alert("Database does not have any changes. It is up-to-date.")})):e.text().then((function(e){alert("An error occurred: "+e)}))})).catch((function(e){console.log(e)}))},n.state={info:data.DatabaseInfo,syncIndicator:!1},n.syncDatabase=n.syncDatabase.bind(n),n}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=null;return this.state.syncIndicator&&(e=React.createElement(SyncIndicator,null)),React.createElement("div",null,e,React.createElement("button",{style:{width:60,cursor:"pointer",marginBottom:20},type:"button",onClick:this.checkDatabaseChanges},"Sync"),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Database name: "),this.state.info.name),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Database user: "),this.state.info.user),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Database host: "),this.state.info.host),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Database driver: "),this.state.info.driver),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Database schema: "),this.state.info.schema),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Database port: "),this.state.info.port))}}]),t}(),SyncIndicator=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.changeText=function(){var e=n.state.text,t=e.indexOf(".");if(-1===t)e+=".";else{var a=e.slice(t,e.length);1===a.length||2===a.length?e+=".":e=e.substr(0,t)}n.setState({text:e})},n.state={text:"Syncing database, please wait"},n.changeText=n.changeText.bind(n),n}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){setInterval(this.changeText,500)}},{key:"render",value:function(){return React.createElement("h1",null,this.state.text)}}]),t}(),TablesData=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.updateTableDictionary=function(e){var t=e.target.getAttribute("data-table-idx"),a=e.target.getAttribute("data-table-name"),o=window.location.protocol+"//"+window.location.host+"/update",l=n.state.tables[t],s=l.columns,r=[];if(confirm("Are you sure you want to update the dictionary of table "+a+"?")){for(var c=0;c<s.length;c++){var i={};i.col_id=s[c].id,i.description=s[c].description,r.push(i)}fetch(o,{method:"POST",body:JSON.stringify({table_id:l.id,table_description:l.description,columns_data:r})}).then((function(e){200===e.status?alert("table "+a+" has been updated successfully."):e.text().then((function(e){alert("An error occurred: "+e)}))})).catch((function(e){console.log(e)}))}},n.onChangeTableDesc=function(e){var t=e.target.getAttribute("data-table-idx"),a=n.state.tables;a[t].description=e.target.value,n.setState({tables:a})},n.onChangeColumnDesc=function(e){var t=e.target.getAttribute("data-table-idx"),a=e.target.getAttribute("data-col-idx"),o=n.state.tables;o[t].columns[a].description=e.target.value,n.setState({tables:o})},n.state={tables:[]},n.onChangeColumnDesc=n.onChangeColumnDesc.bind(n),n.onChangeTableDesc=n.onChangeTableDesc.bind(n),n}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){for(var e=data.Tables,t=data.Columns,n=0;n<e.length;n++){for(var a=[],o=0;o<t.length;o++)t[o].table_name===e[n].name&&a.push(t[o]);for(var l=!1,s=[],r=0;r<a.length;r++)!0===a[r].is_primary_key?l=r:!0===a[r].is_foreign_key&&s.push(r);if("number"==typeof l){var c=a.splice(l,1)[0];a.splice(0,0,c)}for(var i=0;i<s.length;i++){var u=a.splice(s[i],1)[0];a.splice(1,0,u)}for(var d=0;d<a.length;d++)a[d].has_enum&&(a[d].db_type="ENUM("+a[d].enum_values.join()+")");e[n].columns=a}this.setState({tables:e})}},{key:"rendeTables",value:function(){var e=this;return this.state.tables.map((function(t,n){return React.createElement(Table,{key:n,tableIdx:n,tableName:t.name,tableID:t.id,tableDescription:t.description,tableColumns:t.columns,onChangeColumnDesc:e.onChangeColumnDesc,onChangeTableDesc:e.onChangeTableDesc,onClickSave:e.updateTableDictionary})}))}},{key:"render",value:function(){return React.createElement("div",null,this.rendeTables(),React.createElement(TopBtn,null))}}]),t}(),Table=function(e){function t(){var e,n,a;_classCallCheck(this,t);for(var o=arguments.length,l=Array(o),s=0;s<o;s++)l[s]=arguments[s];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),a.renderColumns=function(){return a.props.tableColumns.map((function(e,t){var n="";e.is_primary_key?n="PK":e.is_foreign_key&&(n="FK");var o=e.db_type;"VARCHAR"===e.db_type.toUpperCase()&&(o=o+"("+e.length+")");var l=!0===e.nullable?"YES":"NO",s=!0===e.is_unique?"YES":"NO";return React.createElement("tr",{key:t},React.createElement("td",{style:styles.table},n),React.createElement("td",{style:styles.table},e.name),React.createElement("td",{style:styles.table},o),React.createElement("td",{style:styles.table},l),React.createElement("td",{style:styles.table},s),React.createElement("td",{"data-table":e.table_name,"data-column-id":e.id,style:styles.table},React.createElement("textarea",{"data-table-idx":a.props.tableIdx,"data-table":e.table_name,"data-col-id":e.id,"data-col-idx":t,onChange:a.props.onChangeColumnDesc,rows:"5",cols:"50",value:e.description})))}))},_possibleConstructorReturn(a,n)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{style:{marginTop:50}},React.createElement("p",{style:styles.p},React.createElement("strong",null,"Table: "),this.props.tableName),React.createElement("p",{style:styles.p},React.createElement("strong",null,"Description:")),React.createElement("div",{style:{display:"flex"}},React.createElement("textarea",{"data-table-idx":this.props.tableIdx,onChange:this.props.onChangeTableDesc,rows:"4",cols:"80",value:this.props.tableDescription}),React.createElement("button",{style:{width:60,cursor:"pointer"},type:"button","data-table-name":this.props.tableName,"data-table-idx":this.props.tableIdx,onClick:this.props.onClickSave},"save")),React.createElement("table",{style:styles.table},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:styles.table},"Key"),React.createElement("th",{style:styles.table},"Attribute"),React.createElement("th",{style:styles.table},"Data Type"),React.createElement("th",{style:styles.table},"Nullable"),React.createElement("th",{style:styles.table},"Unique"),React.createElement("th",{style:styles.table},"Description"))),React.createElement("tbody",null,this.renderColumns())))}}]),t}(),TopBtn=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={btn_display_style:"none",btn_opacity:.4},n.handleScroll=n.handleScroll.bind(n),n}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){window.addEventListener("scroll",this.handleScroll)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll)}},{key:"handleScroll",value:function(){var e=document.body.scrollTop,t=document.documentElement.scrollTop;e>20||t>20?this.setState({btn_display_style:"block"}):this.setState({btn_display_style:"None"})}},{key:"render",value:function(){var e=this,t={};return t.top_btn={display:this.state.btn_display_style,position:"fixed",bottom:20,right:30,zIndex:99,fontSize:18,border:"none",outline:"none",color:"grey",cursor:"pointer",padding:15,borderRadius:4,opacity:this.state.btn_opacity},React.createElement("div",null,React.createElement("button",{style:t.top_btn,id:"myBtn",onClick:function(){document.documentElement.scrollTop=0},onMouseOver:function(){return e.setState({btn_opacity:.8})},onMouseOut:function(){return e.setState({btn_opacity:.4})}},"Go to top"))}}]),t}(),styles={p:{margin:0},table:{border:"1px solid black"},saveBtn:{color:"white",padding:"15px 32px",textAlign:"center",fontSize:16,cursor:"pointer",backgroundColor:"#008CBA",marginLeft:3,outline:"none"}},domContainer=document.querySelector("#databaseInfo"),domContainerTwo=document.querySelector("#tablesData");ReactDOM.render(e(DatabaseInfo),domContainer),ReactDOM.render(e(TablesData),domContainerTwo);